<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PESADA - Exibi√ß√£o (Corrigido)</title>

<style>
  :root{ --bg:#123; --accent:#32cd32; --accent2:#ffa500; --card:#000; }
  html,body{height:100%;margin:0}
  body{
    font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff;
    display:flex;flex-direction:column;align-items:center
  }
  header{
    width:100%;padding:16px;text-align:center;
    background:linear-gradient(90deg,var(--accent),var(--accent2),var(--bg));
    box-shadow:0 4px 10px rgba(0,0,0,.25)
  }
  header img.logo{width:160px;display:block;margin:0 auto 8px}
  header h1{margin:0;font-size:1.6rem}
  header p{margin:6px 0 0}
  .button-full{
    margin-top:10px;padding:10px 18px;border-radius:8px;border:none;
    background:#fff;color:#123;cursor:pointer
  }
  .container{width:100%;max-width:1400px;padding:14px;box-sizing:border-box}

  /* ======== √ÅREA DE EXIBI√á√ÉO ========= */
  .report-container{
    position:relative;width:100%;height:560px;
    background:var(--card);overflow:hidden;border-radius:16px
  }

  /* üëâ FULLSCREEN REAL (100% DA TELA, SEM BORDAS PRETAS) */
  .report-container:fullscreen,
  .report-container:-webkit-full-screen,
  .report-container:-ms-fullscreen {
    width:100vw !important;
    height:100vh !important;
    max-width:100vw !important;
    max-height:100vh !important;
    border-radius:0 !important;
    margin:0 !important;
    padding:0 !important;
    background:#000 !important;
  }

  .image-container{
    position:absolute;top:0;left:0;width:100%;height:100%;
    display:flex;align-items:center;justify-content:center;background:#000
  }

  /* üëâ IMAGEM 100% DA TELA, AJUSTADA */
  .image-container img{
    position:absolute;
    width:100%;
    height:100%;
    max-width:100%;
    max-height:100%;
    object-fit:contain !important;
    top:0;left:0;
    opacity:0;
    transition:opacity .8s ease;
  }

  /* üëâ FULLSCREEN de verdade */
  .report-container:fullscreen img,
  .report-container:-webkit-full-screen img,
  .report-container:-ms-fullscreen img{
    width:100vw !important;
    height:100vh !important;
    max-width:100vw !important;
    max-height:100vh !important;
    object-fit:contain !important;
    background:#000 !important;
    position:absolute !important;
    top:0 !important;
    left:0 !important;
    transform:none !important;
  }

  .image-container img.active{opacity:1}

  .empty-msg{
    display:flex;align-items:center;justify-content:center;
    height:100%;color:#fff;font-size:20px
  }

  .controls{
    display:flex;gap:8px;justify-content:center;margin-top:12px
  }
  .btn{
    background:#fff;border:none;padding:8px 12px;
    border-radius:8px;cursor:pointer;color:#000
  }
  .status{color:#fff;margin-left:10px}

  @media (max-width:600px){
    .report-container{height:360px}
    header h1{font-size:1.2rem}
  }
</style>
</head>

<body>

<header>
  <img class="logo" src="img/logo.png" alt="logo" />
  <h1>Equipes Pesadas ‚Äî Exibi√ß√£o</h1>
  <p>Unidade Rio Verde - Grupo Partnership</p>
  <div><button id="fullscreenBtn" class="button-full">TELA CHEIA</button></div>
</header>

<div class="container">
  <div id="reportContainer" class="report-container">
    <div id="slideshow" class="image-container">
      <div id="empty" class="empty-msg" style="display:none">Nenhuma imagem cadastrada</div>
    </div>
  </div>

  <div class="controls">
    <button id="prevBtn" class="btn">‚óÄ</button>
    <button id="pauseBtn" class="btn">Pausar</button>
    <button id="nextBtn" class="btn">‚ñ∂</button>
    <div class="status" id="status">Aguardando dados...</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBehqlRiCiDniyPi3bjHtkH7q2-Px-KoZc",
  authDomain: "cadastr-produtos-clevir.firebaseapp.com",
  databaseURL: "https://cadastr-produtos-clevir-default-rtdb.firebaseio.com",
  projectId: "cadastr-produtos-clevir",
  storageBucket: "cadastr-produtos-clevir.firebasestorage.app",
  messagingSenderId: "1028296092810",
  appId: "1:1028296092810:web:86859328b19c1fdf511173",
  measurementId: "G-JGE4Q09NX8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const DB_NODE = "RELATORIOS-PESADAS-PRTNRV";

const slideshow = document.getElementById("slideshow");
const emptyMsg = document.getElementById("empty");
const statusEl = document.getElementById("status");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const pauseBtn = document.getElementById("pauseBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const reportContainer = document.getElementById("reportContainer");

let images = [];
let index = 0;
let tempo = 5000;
let timer = null;
let paused = false;

function render() {
  slideshow.querySelectorAll("img").forEach(img => img.remove());

  if (!images.length) {
    emptyMsg.style.display = "flex";
    statusEl.textContent = "Sem imagens";
    clearTimeout(timer);
    return;
  }

  emptyMsg.style.display = "none";

  images.forEach((it, i) => {
    const img = document.createElement("img");
    img.src = it.url || it;
    img.alt = it.filename || ("img-" + i);
    if (i === index) img.classList.add("active");
    slideshow.appendChild(img);
  });

  statusEl.textContent = `Imagem ${index+1} / ${images.length}`;
  restartTimer();
}

function restartTimer(){
  clearTimeout(timer);
  if (paused || !images.length) return;
  timer = setTimeout(()=>{ next(); restartTimer(); }, tempo);
}

function next(){
  const imgs = slideshow.querySelectorAll("img");
  if (!imgs.length) return;
  imgs[index].classList.remove("active");
  index = (index + 1) % imgs.length;
  imgs[index].classList.add("active");
}

function prev(){
  const imgs = slideshow.querySelectorAll("img");
  if (!imgs.length) return;
  imgs[index].classList.remove("active");
  index = (index - 1 + imgs.length) % imgs.length;
  imgs[index].classList.add("active");
}

prevBtn.onclick = ()=>{ prev(); restartTimer(); };
nextBtn.onclick = ()=>{ next(); restartTimer(); };
pauseBtn.onclick = ()=>{
  paused = !paused;
  pauseBtn.textContent = paused ? "Retomar" : "Pausar";
  if (!paused) restartTimer(); else clearTimeout(timer);
};

fullscreenBtn.onclick = ()=>{
  if (!document.fullscreenElement) reportContainer.requestFullscreen();
  else document.exitFullscreen();
};

onValue(ref(db, DB_NODE), (snap)=>{
  const data = snap.val();
  if (!data) { images=[]; index=0; render(); return; }

  tempo = parseInt(data.tempo) || 5000;

  const imgsRaw = data.imagens ?? data.images ?? null;
  if (!imgsRaw) { images=[]; index=0; render(); return; }

  if (Array.isArray(imgsRaw)) {
    images = imgsRaw.map((v,i)=> ({ key:i, url:(v?.url || v), createdAt:v?.createdAt || 0 }));
  } else if (typeof imgsRaw === "object") {
    images = Object.entries(imgsRaw).map(([k,v])=>({ key:k, url:(v?.url || v), createdAt:v?.createdAt || 0 }));
  }

  images.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));

  if (index >= images.length) index = 0;
  render();
});
</script>

</body>
</html>
